<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwoleMates</title>
</head>
<body>
    <div id="wrapper">
        <div id="nav">
            <div id="nav_left">
                <h1>LOGO</h1>
                <h1>SwoleMates</h1>
            </div>
            <div id="nav_right">
                <h3><a href="/swolemates/user/{{user.username}}/friends">Friends</a></h3>
                <h3><a href="/swolemates/user/{{user.username}}/workouts">Workouts</a></h3>
                <h3> <a href="/swolemates/user/{{user.username}}">{{ user.username }}</a></h3>
                <form action="logout" method="POST">
                    {% csrf_token %}
                    <input type="submit" value="LOGOUT" class="button" id="logout">
                </form>
            </div>
        </div>

        <div id="main_content">

            <div id="make_post">
                <form action="swolemates/home_post_create" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}

                    <!-- ADD WORKOUT TO POST -->
                    {% if user_workouts %}
                        <select name="workout" id="">
                            <option value="none" selected>Add A Workout?</option>
                            {% for workout in user_workouts %}
                                <option value="{{workout.id}}">{{workout.name}}</option>
                            {% endfor %}
                        </select>
                    {% endif %}

                    <input type="file" name="image">
                    <textarea name="content" id="" cols="50" rows="5" placeholder="Post Something"></textarea>
                    <input type="submit" value="POST">

                </form>
            </div>

            <div id="post_wrapper">
                {% for post in posts reversed %}
                    <div class="post">
                        
                        <img src='/media/{{post.posted_by.profile_photo}}' alt = "profile photo" height="30px">
                        <h3>{{ post.posted_by }}</h3>
                        <p>{{ post.updated_at }}</p>

                        {% if post.posted_by == user %}
                            <a href="/swolemates/post/{{post.id}}/edit">Edit Post</a>
                        {% endif %}

                        {% if post.image %}
                            <img src="/media/{{post.image}}" alt="{{post.posted_by}} image">
                        {% endif %}

                        {% if post.workout %}
                            <a href="/swolemates/workout/{{post.workout.id}}">{{post.workout.name}}</a>
                            {% for exercise in post.workout.exercises.all %}
                                <h5>Exercise: {{exercise.name}}</h5>
                                <p>{{exercise.set_count}}x{{exercise.rep_count}}</p>
                            {% endfor %}
                        {% endif %}
                        
                        <p>{{ post.content }}</p>
                        
                    </div>
    
                    <!-- ADD/REMOVE LIKES -->
                        <!-- <p>Liked By: {{post.liked_by.all}}</p> -->
                        <p>{{post.liked_by.all|length}} Likes</p>
                        {% if user in post.liked_by.all %}
                            <form action="swolemates/home/post/{{post.id}}/remove_like" method="POST">
                                {% csrf_token %}
                                <input type="submit" value="Unlike">
                            </form>
                        {% else %}
                            <form action="swolemates/home/post/{{post.id}}/add_like" method="POST">
                                {% csrf_token %}
                                <input type="submit" value="Like">
                            </form>
                        {% endif %}
    
    
                    <!-- POST A COMMENT SECTION -->
                    <div class="profile_make_comment">
                        
                        <form action="swolemates/home/post/{{post.id}}/add_comment" method="POST">
                            {% csrf_token %}
                            <textarea name="content" id="" cols="30" rows="2" placeholder="Add a comment"></textarea>
                            <input type="submit" value="Comment">
                        </form>
                    </div>
    
                    <!-- ALL COMMENTS -->
                    {% for comment in post.comments.all %}
                        <img src="/media/{{ comment.posted_by.profile_photo }}" alt="{{ comment.posted_by.username }}'s photo" height="30px">
                        <h5>{{comment.posted_by.username}}</h5>
                        <p>{{comment.updated_at}}</p>
                        <p>{{comment.content}}</p>
    
                        <!-- ADD/REMOVE LIKES -->
                        <!-- <p>Liked By: {{post.liked_by.all}}</p> -->
                        <p>{{comment.liked_by.all|length}} Likes</p>
                        {% if user in comment.liked_by.all %}
                            <form action="swolemates/home/comment/{{comment.id}}/remove_like" method="POST">
                                {% csrf_token %}
                                <input type="submit" value="Unlike">
                            </form>
                        {% else %}
                            <form action="swolemates/home/comment/{{comment.id}}/add_like" method="POST">
                                {% csrf_token %}
                                <input type="submit" value="Like">
                            </form>
                        {% endif %}
    
                        <!-- DELETE COMMENT -->
                        {% if comment.posted_by == user %}
                            <form action="swolemates/home/post/{{post.id}}/comment/{{comment.id}}/delete" method="POST">
                                {% csrf_token %}
                                <input type="submit" value="Delete Comment">
                            </form>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>

            <div id="main_right">

                <div id="main_friends_list">
                    {% if friends %}

                        <h2><a href="/swolemates/user/{{user.username}}/friends">Friends</a></h2>
                            {% for friend in friends %}
                                <div class="profile_friend_tile">
                                    <img src="/media/{{friend.profile_photo}}" alt="{{friend.username}}'s profile pic">
                                    <div class="tile_text">
                                        <h3><a href="/swolemates/user/{{friend.username}}">{{ friend.username }}</a></h3>
                                        <p>{{ friend.first_name }} {{ friend.last_name }}</p>
                                        
                                        <!-- REMOVE FRIEND -->
                                        <form action="/swolemates/request/{{ friend.username }}/remove_friend" method="POST">
                                            {% csrf_token %}
                                            <input type="submit" value="Remove Friend">
                                        </form>
                                    </div>
                                </div>
                            {% endfor %}
                    {% endif %}
                    {% if user_friend_requests %}
                        <h2>Friend Requests</h2>
                        {% for person in user_friend_requests %}
                            <div class="profile_friend_tile">
                                <img src="/media/{{person.profile_photo}}" alt="{{person.username}} profile pic">
                                <div class="tile_text">
                                    <h3><a href="/swolemates/user/{{person.username}}">{{ person.username }}</a></h3>
                                    <p>{{ person.first_name }} {{ person.last_name }}</p>
                                    
                                    <!-- ACCEPT REQUEST -->
                                    <form action="/swolemates/request/{{ person.username }}/accept_request" method="POST">
                                        {% csrf_token %}
                                        <input type="submit" value="Accept Friend Request">
                                    </form>
                                    
                                    <!-- DENY REQUEST -->
                                    <form action="/swolemates/request/{{ person.username }}/deny_request" method="POST">
                                        {% csrf_token %}
                                        <input type="submit" value="Deny Friend Request">
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}

                        <h2>Add Friends</h2>
                            {% for person in all_others %}
                                {% if person not in friends and person not in user_friend_requests and person not in user_sent_requests %}
                                    <div class="home_friend_tile">
                                        <img src="/media/{{person.profile_photo}}" alt="{{person.username}} profile pic">
                                        <div class="tile_text">
                                            <h3><a href="/swolemates/user/{{person.username}}">{{ person.username }}</a></h3>
                                            <p>{{ person.first_name }} {{ person.last_name }}</p>
                                            <form action="/swolemates/request/{{ person.username }}/send_request" method="POST">
                                                {% csrf_token %}
                                                <input type="submit" value="Send Friend Request">
                                            </form>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                </div>

                <div id="main_workouts">
                    {% if user_workouts %}
                        <h2>Your Workouts</h2>
                        {% for workout in user_workouts %}
                            <div class="workout_tile">
                                <img src="/media/{{user.profile_photo}}" alt="profile pic">
                                <div class="tile_text">
                                    <h3><a href="/swolemates/workout/{{workout.id}}">{{ workout.name }}</a></h3>
                                <p>Created By: {{user.username}} on {{user.created_at}}</p>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                    <h3><a href="/swolemates/workout">Create a Workout</a></h3>
                </div>

            </div>

        </div>
    </div>
</body>
</html>